
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/fci_for_causal_discovery.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_fci_for_causal_discovery.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_fci_for_causal_discovery.py:


.. _ex-fci-algorithm:

========================================================================
Fast Causal Inference (FCI) for causal discovery from observational data
========================================================================

We will simulate some observational data and demonstrate how we
will use the FCI algorithm.

.. GENERATED FROM PYTHON SOURCE LINES 11-22

.. code-block:: default


    # Authors: Adam Li <adam2392@gmail.com>
    #
    # License: BSD (3-clause)

    import numpy as np

    from causal_networkx import StructuralCausalModel
    from causal_networkx.ci import GSquareCITest, Oracle
    from causal_networkx.discovery import FCI








.. GENERATED FROM PYTHON SOURCE LINES 23-24

Simulate some data

.. GENERATED FROM PYTHON SOURCE LINES 24-54

.. code-block:: default


    # set a random seed to make example reproducible
    seed = 12345
    rng = np.random.RandomState(seed=seed)

    # construct a causal graph that will result in
    # x -> y <- z
    func_uz = lambda: rng.binomial(n=1, p=0.25)
    func_uxy = lambda: rng.binomial(n=1, p=0.4)
    func_x = lambda u_xy: 2 * u_xy
    func_y = lambda x, u_xy, z: x * u_xy + z
    func_z = lambda u_z: u_z

    # construct the SCM and the corresponding causal graph
    scm = StructuralCausalModel(
        exogenous={
            "u_xy": func_uxy,
            "u_z": func_uz,
        },
        endogenous={"x": func_x, "y": func_y, "z": func_z},
    )
    G = scm.get_causal_graph()

    # sample the incomplete observational data
    data = scm.sample(n=5000, include_latents=False)

    # note the graph shows a collider and will not show
    # the unobserved confounder
    G.draw()




.. image-sg:: /auto_examples/images/sphx_glr_fci_for_causal_discovery_001.png
   :alt: fci for causal discovery
   :srcset: /auto_examples/images/sphx_glr_fci_for_causal_discovery_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 55-56

Instantiate some conditional independence tests

.. GENERATED FROM PYTHON SOURCE LINES 56-59

.. code-block:: default

    oracle = Oracle(G)
    ci_estimator = GSquareCITest(data_type="discrete")








.. GENERATED FROM PYTHON SOURCE LINES 60-61

Now we are ready to run the FCI algorithm.

.. GENERATED FROM PYTHON SOURCE LINES 61-68

.. code-block:: default


    fci = FCI(ci_estimator=ci_estimator)
    fci.fit(data)

    # the resulting partial ancestral graph (PAG) that is learned
    graph = fci.graph_
    graph.draw()



.. image-sg:: /auto_examples/images/sphx_glr_fci_for_causal_discovery_002.png
   :alt: fci for causal discovery
   :srcset: /auto_examples/images/sphx_glr_fci_for_causal_discovery_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /home/circleci/project/causal_networkx/ci/g_test.py:199: RuntimeWarning: invalid value encountered in divide
      tlog[:, :, k] = contingency_tble[:, :, k] * nk[k] / tdijk
    /home/circleci/project/causal_networkx/ci/g_test.py:201: RuntimeWarning: divide by zero encountered in log
      log_tlog = np.log(tlog)
    /home/circleci/project/causal_networkx/ci/g_test.py:202: RuntimeWarning: invalid value encountered in multiply
      G2 = np.nansum(2 * contingency_tble * log_tlog)





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  1.027 seconds)


.. _sphx_glr_download_auto_examples_fci_for_causal_discovery.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: fci_for_causal_discovery.py <fci_for_causal_discovery.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: fci_for_causal_discovery.ipynb <fci_for_causal_discovery.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
